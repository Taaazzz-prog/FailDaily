{
  "timestamp": "2025-08-16T16:50:19.141Z",
  "duration": 13293,
  "summary": {
    "total": 9,
    "passed": 1,
    "failed": 8,
    "successRate": 11
  },
  "tests": [
    {
      "name": "1.1 - Connexion Base de Données",
      "category": "Database",
      "success": true,
      "duration": 78,
      "details": {
        "connection": true,
        "tablesCount": 19,
        "usersCount": 2,
        "errors": []
      }
    },
    {
      "name": "1.2 - Structure Base de Données",
      "category": "Database",
      "success": false,
      "duration": 176,
      "details": {
        "tables": {
          "users": {
            "exists": true,
            "columns": [
              "id",
              "email",
              "email_confirmed",
              "password_hash",
              "role",
              "last_login",
              "login_count",
              "account_status",
              "registration_step",
              "created_at",
              "updated_at"
            ],
            "missingColumns": [
              "is_active"
            ],
            "extraColumns": [
              "email_confirmed",
              "last_login",
              "login_count",
              "account_status",
              "registration_step"
            ]
          },
          "profiles": {
            "exists": true,
            "columns": [
              "id",
              "user_id",
              "username",
              "display_name",
              "avatar_url",
              "bio",
              "registration_completed",
              "legal_consent",
              "age_verification",
              "preferences",
              "stats",
              "created_at",
              "updated_at"
            ],
            "missingColumns": [
              "total_points",
              "total_fails",
              "total_badges"
            ],
            "extraColumns": [
              "username",
              "bio",
              "registration_completed",
              "legal_consent",
              "age_verification",
              "preferences",
              "stats",
              "created_at",
              "updated_at"
            ]
          },
          "fails": {
            "exists": true,
            "columns": [
              "id",
              "user_id",
              "title",
              "description",
              "category",
              "image_url",
              "is_public",
              "reactions",
              "comments_count",
              "created_at",
              "updated_at"
            ],
            "missingColumns": [],
            "extraColumns": [
              "reactions",
              "comments_count",
              "updated_at"
            ]
          },
          "badge_definitions": {
            "exists": true,
            "columns": [
              "id",
              "name",
              "description",
              "icon",
              "category",
              "rarity",
              "requirement_type",
              "requirement_value",
              "created_at"
            ],
            "missingColumns": [
              "xp_reward",
              "requirements"
            ],
            "extraColumns": [
              "rarity",
              "requirement_type",
              "requirement_value",
              "created_at"
            ]
          },
          "user_badges": {
            "exists": true,
            "columns": [
              "id",
              "user_id",
              "badge_id",
              "unlocked_at",
              "created_at"
            ],
            "missingColumns": [],
            "extraColumns": [
              "created_at"
            ]
          },
          "reactions": {
            "exists": true,
            "columns": [
              "id",
              "user_id",
              "fail_id",
              "reaction_type",
              "created_at"
            ],
            "missingColumns": [],
            "extraColumns": []
          },
          "system_logs": {
            "exists": true,
            "columns": [
              "id",
              "level",
              "message",
              "action",
              "details",
              "user_id",
              "timestamp",
              "created_at"
            ],
            "missingColumns": [
              "service",
              "metadata"
            ],
            "extraColumns": [
              "action",
              "details",
              "timestamp"
            ]
          }
        },
        "constraints": {},
        "indexes": {
          "users": [
            {
              "name": "PRIMARY",
              "column": "id",
              "unique": true
            },
            {
              "name": "email",
              "column": "email",
              "unique": true
            },
            {
              "name": "idx_users_email",
              "column": "email",
              "unique": false
            },
            {
              "name": "idx_users_status",
              "column": "account_status",
              "unique": false
            }
          ],
          "profiles": [
            {
              "name": "PRIMARY",
              "column": "id",
              "unique": true
            },
            {
              "name": "user_id",
              "column": "user_id",
              "unique": true
            },
            {
              "name": "username",
              "column": "username",
              "unique": true
            }
          ],
          "fails": [
            {
              "name": "PRIMARY",
              "column": "id",
              "unique": true
            },
            {
              "name": "idx_fails_user_id",
              "column": "user_id",
              "unique": false
            },
            {
              "name": "idx_fails_created_at",
              "column": "created_at",
              "unique": false
            }
          ],
          "badge_definitions": [
            {
              "name": "PRIMARY",
              "column": "id",
              "unique": true
            },
            {
              "name": "idx_badge_definitions_category",
              "column": "category",
              "unique": false
            },
            {
              "name": "idx_badge_definitions_rarity",
              "column": "rarity",
              "unique": false
            }
          ],
          "user_badges": [
            {
              "name": "PRIMARY",
              "column": "id",
              "unique": true
            },
            {
              "name": "unique_user_badge",
              "column": "user_id",
              "unique": true
            },
            {
              "name": "unique_user_badge",
              "column": "badge_id",
              "unique": true
            },
            {
              "name": "idx_user_badges_badge_id",
              "column": "badge_id",
              "unique": false
            }
          ],
          "reactions": [
            {
              "name": "PRIMARY",
              "column": "id",
              "unique": true
            },
            {
              "name": "unique_user_fail_reaction",
              "column": "user_id",
              "unique": true
            },
            {
              "name": "unique_user_fail_reaction",
              "column": "fail_id",
              "unique": true
            },
            {
              "name": "idx_reactions_fail_id",
              "column": "fail_id",
              "unique": false
            },
            {
              "name": "idx_reactions_user_id",
              "column": "user_id",
              "unique": false
            }
          ],
          "system_logs": [
            {
              "name": "PRIMARY",
              "column": "id",
              "unique": true
            },
            {
              "name": "system_logs_user_id_fkey",
              "column": "user_id",
              "unique": false
            }
          ]
        },
        "errors": []
      }
    },
    {
      "name": "2.1 - Inscription Utilisateur",
      "category": "Authentication",
      "success": false,
      "duration": 300
    },
    {
      "name": "2.2 - Connexion Utilisateur",
      "category": "Authentication",
      "success": false,
      "duration": 340,
      "details": {
        "userCreated": false,
        "validLogin": false,
        "invalidPassword": false,
        "invalidEmail": false,
        "missingFields": false,
        "tokenFormat": false,
        "errors": [
          "Impossible de créer utilisateur de test"
        ]
      }
    },
    {
      "name": "2.3 - Vérification JWT",
      "category": "Authentication",
      "success": false,
      "duration": 505,
      "details": {
        "userCreated": false,
        "tokenReceived": false,
        "tokenVerification": false,
        "invalidToken": false,
        "missingToken": false,
        "expiredToken": false,
        "middleware": false,
        "errors": [
          "Impossible d'obtenir un token valide"
        ]
      }
    },
    {
      "name": "2.4 - Protection Accès Non Authentifié",
      "category": "Security",
      "success": false,
      "duration": 1365,
      "details": {
        "protectedEndpoints": 11,
        "blockedEndpoints": 9,
        "endpointResults": [
          {
            "name": "GET /api/fails",
            "method": "GET",
            "url": "http://localhost:3001/api/fails",
            "expectedStatus": 401,
            "actualStatus": 200,
            "blocked": false
          },
          {
            "name": "POST /api/fails",
            "method": "POST",
            "url": "http://localhost:3001/api/fails",
            "expectedStatus": 401,
            "actualStatus": 401,
            "blocked": true
          },
          {
            "name": "GET /api/fails/:id",
            "method": "GET",
            "url": "http://localhost:3001/api/fails/123",
            "expectedStatus": 401,
            "actualStatus": 404,
            "blocked": false
          },
          {
            "name": "PUT /api/fails/:id",
            "method": "PUT",
            "url": "http://localhost:3001/api/fails/123",
            "expectedStatus": 401,
            "actualStatus": 401,
            "blocked": true
          },
          {
            "name": "DELETE /api/fails/:id",
            "method": "DELETE",
            "url": "http://localhost:3001/api/fails/123",
            "expectedStatus": 401,
            "actualStatus": 401,
            "blocked": true
          },
          {
            "name": "GET /api/auth/profile",
            "method": "GET",
            "url": "http://localhost:3001/api/auth/profile",
            "expectedStatus": 401,
            "actualStatus": 401,
            "blocked": true
          },
          {
            "name": "PUT /api/auth/profile",
            "method": "PUT",
            "url": "http://localhost:3001/api/auth/profile",
            "expectedStatus": 401,
            "actualStatus": 401,
            "blocked": true
          },
          {
            "name": "GET /api/auth/verify",
            "method": "GET",
            "url": "http://localhost:3001/api/auth/verify",
            "expectedStatus": 401,
            "actualStatus": 401,
            "blocked": true
          },
          {
            "name": "GET /api/user/stats",
            "method": "GET",
            "url": "http://localhost:3001/api/user/stats",
            "expectedStatus": 401,
            "actualStatus": 401,
            "blocked": true
          },
          {
            "name": "GET /api/fails/:id/comments",
            "method": "GET",
            "url": "http://localhost:3001/api/fails/123/comments",
            "expectedStatus": 401,
            "actualStatus": 401,
            "blocked": true
          },
          {
            "name": "POST /api/fails/:id/comments",
            "method": "POST",
            "url": "http://localhost:3001/api/fails/123/comments",
            "expectedStatus": 401,
            "actualStatus": 401,
            "blocked": true
          }
        ],
        "errors": [
          "GET /api/fails - ÉCHEC: attendu 401, reçu 200",
          "GET /api/fails/:id - ÉCHEC: attendu 401, reçu 404",
          "Token invalide devrait être rejeté, reçu: 200",
          "Token expiré devrait être rejeté, reçu: 200",
          "Header malformé devrait être rejeté, reçu: 200"
        ]
      }
    },
    {
      "name": "3.1 - Création de Fails",
      "category": "Fails",
      "success": false,
      "duration": 485,
      "details": {
        "userCreated": false,
        "tokenObtained": false,
        "validFailCreation": false,
        "missingTitle": false,
        "publicFail": false,
        "privateFail": false,
        "categoryValidation": false,
        "responseFormat": false,
        "errors": [
          "Impossible de créer utilisateur de test"
        ]
      }
    },
    {
      "name": "3.2 - Récupération de Fails",
      "category": "Fails",
      "success": false,
      "duration": 520,
      "details": {
        "userCreated": false,
        "failsCreated": 0,
        "getAllFails": false,
        "getFailById": false,
        "publicOnlyFilter": false,
        "pagination": false,
        "categoryFilter": false,
        "unauthorizedAccess": false,
        "errors": [
          "Impossible de créer utilisateur de test"
        ]
      }
    },
    {
      "name": "4.1 - Intégration Complète",
      "category": "Integration",
      "success": false,
      "duration": 447,
      "details": {
        "userRegistration": false,
        "userLogin": false,
        "failCreation": false,
        "failRetrieval": false,
        "userStats": false,
        "endToEndFlow": false,
        "errors": [
          "Inscription échouée: Erreur interne du serveur"
        ]
      }
    }
  ]
}